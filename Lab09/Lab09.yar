rule Lab09_01 {
   meta:
      description = "Lab09_01.exe"
   strings:
      $s1 = "GET" fullword ascii
      $s2 = "CMD" fullword ascii
      $s3 = "DOWNLOAD" fullword ascii
      $s4 = "UPLOAD" fullword ascii
      $s5 = "SLEEP" fullword ascii
      $s6 = "cmd.exe" fullword ascii
      $s7 = "http://www.practicalmalwareanalysis.com" fullword ascii
      $s8 = "-cc" fullword ascii
      $s9 = "-re" fullword ascii
      $s10 = "-in" fullword ascii
   condition:
      uint16(0) == 0x5a4d and 
      uint32(uint32(0x3c))==0x00004550 and filesize < 70KB and
      all of them
}
rule Lab09_02 {
   meta:
      description = "Lab09-02.exe"
   strings:
      $s1 = "cmd" fullword ascii
      $s2 = "WSASocketA" fullword ascii
      $s3 = "GetModuleFileNameA" fullword ascii
      $s4 = "Sleep" fullword ascii
      $s5 = "GetCommandLineA" fullword ascii
   condition:
      uint16(0) == 0x5a4d and 
      uint32(uint32(0x3c))==0x00004550 and filesize < 50KB and
      all of them
}

rule Lab09_03 {
   meta:
      description = "Lab09-03.exe"
   strings:
      $s1 = "malwareanalysisbook.com" fullword ascii
      $s2 = "GetProcAddress" fullword ascii
      $s3 = "WriteFile" fullword ascii
      $s4 = "LoadLibraryA" fullword ascii
      $x1 = "DLL3Print" fullword ascii
      $x2 = "DLL3.dll" fullword ascii
      $x3 = "DLL3GetStructure" fullword ascii
      $y1 = "DLL1Print" fullword ascii
      $y2 = "DLL1.dll" fullword ascii
      $z1 = "DLL2Print" fullword ascii
      $z2 = "DLL2.dll" fullword ascii
      $z3 = "DLL2ReturnJ" fullword ascii
   condition:
      uint16(0) == 0x5a4d and 
      uint32(uint32(0x3c))==0x00004550 and filesize < 50KB and
      1 of ($x*) and 1 of ($y*) and 1 of ($z*) and 2 of ($s*) 
}

rule DLL1 {
   meta:
      description = "DLL1.dll"
   strings:
      $s1 = "DLL1.dll" fullword ascii
      $s2 = "DLL1Print" fullword ascii
      $s3 = "WriteFile" fullword ascii
      $s4 = "DLL 1 mystery data %d" fullword ascii
      $s5 = "H:mm:ss" fullword ascii
   condition:
      uint16(0) == 0x5a4d and 
      uint32(uint32(0x3c))==0x00004550 and filesize < 50KB and
      all of them
}

rule DLL2 {
   meta:
      description = "DLL2.dll"
   strings:
      $s1 = "DLL2.dll" fullword ascii
      $s2 = "DLL2Print" fullword ascii
      $s3 = "DLL2ReturnJ" fullword ascii
      $s4 = "DLL 2 mystery data %d" fullword ascii
      $s5 = "temp.txt" fullword ascii
      $s6 = "CreateFileA" fullword ascii
   condition:
      uint16(0) == 0x5a4d and 
      uint32(uint32(0x3c))==0x00004550 and filesize < 50KB and
      all of them
}

rule DLL3 {
   meta:
      description = "DLL3.dll"
   strings:
      $s1 = "DLL3.dll" fullword ascii
      $s2 = "DLL3Print" fullword ascii
      $s3 = "DLL3GetStructure" fullword ascii
      $s4 = "DLL 3 mystery data %d" fullword ascii
      $s5 = "ping www.malwareanalysisbook.com" fullword ascii
   condition:
      uint16(0) == 0x5a4d and 
      uint32(uint32(0x3c))==0x00004550 and filesize < 50KB and
      all of them
}

