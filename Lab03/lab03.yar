rule Lab03_01 {
   meta:
      description = "Lab03-01.exe"
   strings:
      $s1 = "vmx32to64.exe" fullword ascii
      $s2 = "SOFTWARE\\Classes\\http\\shell\\open\\commandV" fullword ascii
      $s3 = " www.practicalmalwareanalysis.com" fullword ascii
      $s4 = "advpack" fullword ascii
      $s5 = "VideoDriver" fullword ascii
      $s6 = "WinVMX32-" fullword ascii
      $s7 = "Software\\Microsoft\\Active Setup\\Installed Components\\" fullword ascii 
   condition:
      uint16(0) == 0x5a4d and 
      uint32(uint32(0x3c))==0x00004550 and filesize < 20KB and
      5 of them
}
rule Lab03_02 {
   meta:
      description = "Lab03-02.dll"
   strings:
      $x1 = "%SystemRoot%\\System32\\svchost.exe -k " fullword ascii
      $s3 = "RegOpenKeyEx(%s) KEY_QUERY_VALUE error ." fullword ascii
      $s4 = "practicalmalwareanalysis.com" fullword ascii
      $s5 = "Lab03-02.dll" fullword ascii
      $s6 = "RegOpenKeyEx(%s) KEY_QUERY_VALUE success." fullword ascii
      $s7 = "serve.html" fullword ascii
      $s8 = "GetModuleFileName() get dll path" fullword ascii
      $s9 = "netsvcs" fullword ascii
      $s10 = "OpenService(%s) error 2" fullword ascii
      $s11 = "OpenService(%s) error 1" fullword ascii
      $s12 = "CreateService(%s) error %d" fullword ascii
      $s13 = "You specify service name not in Svchost//netsvcs, must be one of following:" fullword ascii
      $s14 = "RegQueryValueEx" fullword ascii
      $s15 = "Depends INA+" fullword nocase
   condition:
      uint16(0) == 0x5a4d and 
      uint32(uint32(0x3c))==0x00004550 and filesize < 70KB and
      all of ($x*) and 6 of them
}
rule Lab03_03 {
   meta:
      description = "Lab03-03.exe"
   strings:
      $s1 = "\\svchost.exe" fullword ascii
      $s2 = "+A+A+A+A" fullword ascii
   condition:
      uint16(0) == 0x5a4d and 
      uint32(uint32(0x3c))==0x00004550 and filesize < 200KB and
      all of them
}
rule Lab03_04 {
   meta:
      description = "Lab03-04.exe"
   strings:
      $s1 = "http://www.practicalmalwareanalysis.com" fullword ascii
      $s2 = "%SYSTEMROOT%\\system32\\" fullword ascii
      $s3 = " HTTP/1.0" fullword ascii
      $s4 = " Manager Service" fullword ascii
      $s5 = "UPLOAD" fullword ascii
      $s6 = "DOWNLOAD" fullword ascii 
      $s7 = "command.com" fullword ascii 
      $s8 = "COMSPEC" fullword ascii 
      $s9 = "SOFTWARE\\Microsoft \\XPS" fullword ascii
      $s10 = "/c del " fullword ascii
      $s11 = " >> NUL" fullword ascii
   condition:
      uint16(0) == 0x5a4d and 
      uint32(uint32(0x3c))==0x00004550 and filesize < 200KB and
      8 of them
}