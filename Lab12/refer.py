# 导入IDA Python模块
import idaapi
import idautils

def find_and_display_xrefs(target_function_name):
    # 获取目标函数的EA（地址）
    target_function_ea = idaapi.get_name_ea(0, target_function_name)

    if target_function_ea != idaapi.BADADDR:
        # 查找对目标函数的交叉引用
        xrefs = list(idautils.XrefsTo(target_function_ea))

        if xrefs:
            print(f"找到 {len(xrefs)} 个对 {target_function_name} 的交叉引用：")
            for xref in xrefs:
                print(f"来自 {idaapi.get_func_name(xref.frm)}，地址：0x{target_function_ea:X}")
        else:
            print(f"未找到对 {target_function_name} 的交叉引用。")
    else:
        print(f"未找到函数 {target_function_name}。")

if __name__ == "__main__":
    # 设置目标函数的名称
    target_function_name = "EnumProcessModules"

    # 调用函数查找和显示交叉引用
    find_and_display_xrefs(target_function_name)
